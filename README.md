# 画像リサイズ・圧縮ツール (v0.2.2)

日本語ファイル名に対応した画像リサイズ・圧縮ツールです。指定されたディレクトリから画像ファイル(.jpg, .png)を検索し、指定された幅にリサイズして、圧縮率を指定してJPEG形式で保存します。コマンドライン版とGUI版の両方を提供しています。

![GUI画面例](.github/screenshots/gui_example.png)

## 機能

- 横幅を指定してリサイズ（アスペクト比維持）
- JPEG圧縮率の調整
- 日本語ファイル名・フォルダ名対応
- ディレクトリ構造の維持
- Windowsのパス長制限対応（260文字以上のパスも対応）
- 絵文字を含むファイル名に対応（例: 🍣.jpg）
- ドライラン機能（変更前に処理内容を確認）
- 詳細なログ出力
- GUIモードとコマンドラインモードの両方に対応
- 非同期処理と進捗表示

## 前提条件

- Python 3.12以上
- 依存ライブラリ：
  - Pillow: 画像処理
  - loguru: ロギング
  - tqdm: 進捗表示（CLI版）
  - TkEasyGUI: GUIフレームワーク（GUI版）

## インストール

### uvを使用したインストール（推奨）

[uv](https://github.com/astral-sh/uv) は高速なPythonパッケージマネージャーです。まずはuvをインストールしてください。

```bash
# リポジトリのクローン
git clone https://github.com/tsutomu-n/edit-img.git
cd edit-img

# 仮想環境の作成
uv venv

# 仮想環境の有効化
# Windowsの場合
.venv\Scripts\activate
# Linux/macOSの場合
source .venv/bin/activate

# 依存ライブラリのインストール
uv sync
```

### pipを使用したインストール

```bash
# リポジトリのクローン
git clone https://github.com/tsutomu-n/edit-img.git
cd edit-img

# 仮想環境の作成
python -m venv .venv

# 仮想環境の有効化
# Windowsの場合
.venv\Scripts\activate
# Linux/macOSの場合
source .venv/bin/activate

# 依存ライブラリのインストール
pip install -e .
```

## 使用方法

コマンドライン版とGUI版の二つの方法で利用できます。

### 1. ディレクトリ構造

処理したい画像ファイルを `input` ディレクトリ内に配置します。

```
edit-img/
  ├─ input/            # 入力画像を配置するディレクトリ
  │   ├─ 山田太郎/     # 人物名ごとのフォルダ
  │   │   ├─ 足場.jpg   # 資格画像
  │   │   └─ クレーン.jpg
  │   ├─ 鈴木一郎/
  │   │   └─ ...
  │   └─ ...
  │
  ├─ output/           # 処理済み画像の出力先
  ├─ resize_images.py    # CLI版処理スクリプト
  ├─ resize_images_gui.py # GUI版処理スクリプト
  └─ resize_core.py     # コア機能モジュール
```

### 2. GUI版の起動方法

```bash
# 直接実行
python resize_images_gui.py

# またはインストール後
edit-img-gui
```

GUIアプリケーションが起動します。以下のステップで操作します：

1. 入力フォルダと出力フォルダを選択（「参照」ボタンでブラウズ可能）
2. リサイズ幅とJPEG品質をスライダーで調整
3. プレビューモードのチェックボックスを確認（デフォルトはオン）
4. 「プレビュー」ボタンで実際にファイルを保存せず処理をシミュレート
5. または「実行」ボタンをクリックして実際の処理を開始
6. 進捗バーで処理状況を確認
7. 必要に応じて「キャンセル」ボタンで処理を中断

### 3. コマンドライン版の使い方

```bash
# 基本的な使い方
python resize_images.py

# またはインストール後
edit-img-cli
```

### 4. プレビュー/ドライランモード

**GUI版**:
アプリケーション起動時にデフォルトでプレビューモードが有効になっています。このモードでは実際にファイルを保存せず、処理結果を予測してサイズ削減率などを表示します。

**CLI版**:
```bash
python resize_images.py --dry-run
```

### 5. カスタム設定（CLI版）

```bash
# 横幅800px、JPEG品質90%で処理
python resize_images.py --width 800 --quality 90

# 詳細出力モード
python resize_images.py --verbose

# 入力・出力ディレクトリを指定
python resize_images.py --source "別のパス" --destination "別の出力先"
```

## オプション一覧（CLI版）

| オプション | 短縮形 | デフォルト値 | 説明 |
|----------|-------|------------|------|
| `--source` | `-s` | `./input` | 入力ディレクトリのパス |
| `--destination` | `-d` | `./output` | 出力先ディレクトリのパス |
| `--width` | `-w` | `1200` | リサイズする幅（ピクセル） |
| `--quality` | `-q` | `87` | JPEG品質（1-100） |
| `--dry-run` | なし | `False` | ドライラン実行（実際に変更しない） |
| `--verbose` | `-v` | `False` | 詳細出力モード |

## 処理結果

処理結果は `output` ディレクトリに保存され、元のディレクトリ構造が維持されます。

例：
- 入力：`input/山田太郎/足場.jpg`
- 出力：`output/山田太郎/足場.jpg`（リサイズ・圧縮済み）

## ログ

処理の詳細なログは `process_日付.log` ファイルに記録されます。エラーが発生した場合は、このログファイルを確認してください。

## 変更履歴

### v0.2.2 (2025-04-24)

- **プレビューモード機能の強化**: GUI版にプレビューモードをデフォルトで有効化
- **GUIの改善**: 「プレビュー」と「実行」ボタンを分離し、視覚的にわかりやすく改善
- **設定保存機能の追加**: 前回使用した設定を記憶して次回起動時に反映
- **ユーザーエクスペリエンスの向上**: 処理モードに合わせた結果表示の最適化

### v0.2.1 (2025-04-24)

- **Windows長パス対応の強化**: 260文字を超えるパスや特殊文字を含むパスを適切に処理
- **絵文字を含むファイル名の対応**: 🍣.jpgのような絵文字を含むファイル名も正しく処理
- **TkEasyGUIの互換性問題を修正**: ProgressBarの代わりにSliderコンポーネントを使用して進捗表示を実装
- **変数スコープ問題の修正**: 例外処理ブロック内での`dest_dir`変数アクセスエラーを解決
- **リサイズ関数のバグ修正**: 未定義変数参照や冗長なreturn文など複数の問題を修正
- **コード構造の改善**: コア機能を分離し、GUI版とCLI版で共有化

### v0.2.0 (2025-04-19)

- GUIモードの追加: TkEasyGUIを使用したグラフィカルユーザーインターフェースを実装
- インストール方法の改善: uvによるパッケージ管理をサポート

### v0.1.0 (2025-04-03)

- 最初のリリース: CLIモードのみ

## 他プラットフォームでの実行

このツールは以下のプラットフォームで動作確認済みです：

- Windows 10/11（日本語版） - 完全対応
  - v0.2.1では長いパス（260文字以上）や絵文字を含むファイル名への対応を強化
- Linux (Ubuntuなど) - 完全対応
- macOS - 完全対応

### Windows環境の特別なケース

v0.2.1では以下の特別なケースに対応しています：

1. **長いパスの処理**: Windowsの260文字制限を超えるパスも適切に処理します。
2. **絵文字を含むファイル名**: 🍣.jpgのような絵文字を含むファイル名も正しく処理します。
3. **日本語のフォルダ名とファイル名**: 日本語が含まれるパスを適切に処理します。

### GUI版の起動（X11を使用する環境）

Linuxサーバー環境などでGUIを表示する場合は、X11転送が必要です。

```bash
# SSHでX11転送を有効にして接続
ssh -X username@hostname

# WindowsのWSL2で実行する場合
# 1. VcXsrvなどのX serverをインストール
# 2. 環境変数を設定
export DISPLAY=:0
```

## 注意事項

- 大量の画像を処理する場合は、メモリ使用量に注意してください。
- 元のファイル名に使用できない文字（`\ / : * ? " < > |`）が含まれていた場合、自動的に安全なファイル名に変換されます。
- `.jpg`と`.jpeg`以外の拡張子を持つファイル（PNGなど）は、JPEG形式に変換されます。
- GUI版では、処理中にアプリケーションが応答しなくなった場合でもバックグラウンドで処理が続行されています。キャンセルボタンで中断できます。
- Windows環境で長いパス名（260文字以上）のファイルを処理する場合、自動的に長いパス対応モードで処理されます。
- GUI版ではプレビューモードがデフォルトで有効になっています。実際にファイルを保存するには「実行」ボタンを使用するか、プレビューモードのチェックを外してください。
- 設定はアプリケーション終了時に自動保存され、次回起動時に反映されます。

## コントリビューション

本プロジェクトへの貢献を歓迎します。バグ報告や機能要望は、GitHubのIssueでご報告ください。
