# 📸 画像リサイズ・圧縮ツール CLI版マニュアル

コマンドライン版の画像リサイズ・圧縮ツールの使い方を詳しく解説します。このツールを使えば、大量の画像を自動でリサイズして圧縮できます。

## はじめに

コマンドラインを使うのが初めての方へ：

- **Windowsの場合**：「スタート」→「検索」→「コマンドプロンプト」または「PowerShell」を入力して開きます
- **Macの場合**：「Finder」→「アプリケーション」→「ユーティリティ」→「ターミナル」を開きます
- **Linuxの場合**：デスクトップ環境によって異なりますが、多くの場合「Ctrl+Alt+T」でターミナルが開きます

コマンドラインでは、テキストコマンドを入力して実行します。このマニュアルでは、コピー＆ペーストで簡単に実行できるように全てのコマンドを提供しています。

## 📋 準備するもの

1. **Python環境**  
   Python 3.6以上が推奨されます。  
2. **必要なライブラリ**  
   `Pillow`, `loguru`, `tqdm` などが依存ライブラリです。  
3. **画像ファイル**  
   処理したいJPEG（`.jpg`, `.jpeg`）またはPNG（`.png`）画像を用意してください。

---

## 🚀 基本的な使い方（ステップバイステップ）

### 1. 仮想環境を有効化する

```bash
# Linux/macOS
source .venv/bin/activate

# Windows
.venv\Scripts\activate
```

環境が有効化されると、プロンプトの先頭に `(.venv)` が表示されます。

### 2. 入出力ディレクトリを準備する

```bash
# 入力用ディレクトリがなければ作成
mkdir -p input

# 出力用ディレクトリがなければ作成
mkdir -p output

# 画像を input/ にコピー
cp /path/to/images/*.jpg input/
```

### 3. 最もシンプルに実行する

```bash
python resize_images.py --source ./input --dest ./output
```

基本的な設定で処理が始まります：
- 入力: `./input`（必須指定）
- 出力: `./output`（必須指定）
- 幅: 1280px（デフォルト）
- 品質: 85%（デフォルト）

---

## 🛠️ 主なオプション解説

### 入出力設定

| オプション | 短縮形 | 必須 | 説明 |
|------------|-------|-----------|------------------------------|
| `--source` | `-s` | ✓ | 入力ディレクトリのパス（必須） |
| `--dest` | `-d` | ✓ | 出力ディレクトリのパス（必須） |

```bash
python resize_images.py --source /path/to/src --dest /path/to/out
```

### 画質・サイズ設定

| オプション | 短縮形 | デフォルト | 説明 |
|--------------|-------|----------|---------------------------------------|
| `--width` | `-w` | `1280` | リサイズ後の画像幅（px）、縦は自動調整 |
| `--quality` | `-q` | `85` | JPEG品質（1–100）、高いほど高画質だがサイズ大きい |

```bash
python resize_images.py -w 800 -q 90
```

### 動作モード

| オプション | デフォルト | 説明 |
|------------------|---------|---------------------------------------|
| `--dry-run` | `False` | ドライラン（実際の書き換えをせずシミュレート） |
| `--resume` | `False` | 既存ファイルがあればスキップして続きから処理 |

```bash
# まずドライランで確認
python resize_images.py --dry-run

# 問題なければ本実行
python resize_images.py
```

### ログ関連

| オプション | デフォルト | 説明 |
|--------------------|---------|----------------------------------|
| `--log-level` | `INFO` | ログレベル（DEBUG, INFO, WARNING…） |
| `--debug` | `False` | デバッグモード（詳細エラー表示） |
| `--check-disk` | `False` | 処理前にディスク容量をチェック |

```bash
python resize_images.py --log-level DEBUG --check-disk
```

---

## 📊 使用例

### 1. Web用に最適化

```bash
python resize_images.py -w 1200 -q 80
```

### 2. 高品質アーカイブ

```bash
python resize_images.py -w 1600 -q 95
```

### 3. 大量画像をバッチ処理

```bash
# 一括テスト
python resize_images.py --dry-run --source batch1

# 本処理
python resize_images.py --source batch1

# 次のバッチ
python resize_images.py --source batch2
```

---

## 🔄 処理の流れ

### 1. 初期化
引数解析とログ設定が行われます。

```
処理を開始します: 幅 1280px, 品質 85%
```

### 2. ファイル検索
入力ディレクトリから画像を収集します。

```
入力ディレクトリから画像を検索中… 合計 42 ファイル
```

### 3. リサイズ＆圧縮
1枚ずつ処理し、進捗を出力します。

```
処理中 [1/42]: input/img01.jpg  
  ✓ 2.4MB → 0.6MB (75.0% 削減)
```

### 4. 結果集計
処理結果をまとめて表示します。

```
【処理結果】  
成功: 42件  
エラー: 0件  
スキップ: 0件  
合計削減: 120.5MB → 32.7MB (72.9% 削減)  
処理時間: 8.45秒
```

---

## 🔧 トラブルシューティング

### 1. 「入力ディレクトリが見つかりません」
- パスを引用符で囲んでみてください
- 実際にディレクトリが存在しているか確認しましょう

### 2. メモリ不足エラー
- 幅を小さくしてみてください（例：`--width 800`）
- バッチサイズを減らすために一度に処理するファイル数を減らしましょう
- 他のアプリケーションを閉じてメモリを解放してみてください

### 3. 権限エラー

```bash
chmod -R 755 input output
```

### 4. 「ファイル形式がサポートされていません」
- サポートされている形式は `.jpg`、`.jpeg`、`.png` のみです
- 他の形式（`.gif`、`.bmp` など）は事前に変換しておく必要があります

## よくある質問

### Q: 処理に時間がかかりすぎます
大きな画像や多数のファイルを処理する場合は時間がかかります。小さなバッチに分けて処理するか、幅を小さくすると速くなります。

### Q: 出力画像の品質が低すぎます
`--quality` オプションで品質値を上げてみてください（例：`--quality 95`）。

### Q: 日本語のファイル名が文字化けします
パスを引用符（`""`）で囲んで実行してみてください：
```bash
python resize_images.py --source "日本語フォルダ" --dest "出力先"
```

### Q: ファイルが多すぎて処理できません
ファイルを複数のフォルダに分けて、一つずつ処理しましょう。または `--resume` オプションを使って、途中から再開できるようにしましょう。

## 高度な使い方

### シェルスクリプトでの自動化

複数のディレクトリを順番に処理するスクリプトの例です：

```bash
#!/bin/bash
source .venv/bin/activate

# 処理するディレクトリのリスト
DIRS=("photos_2022" "photos_2023" "photos_2024")

# 各ディレクトリを処理
for dir in "${DIRS[@]}"; do
  echo "処理中: $dir"
  python resize_images.py --source "$dir" --dest "resized_$dir" --width 1200 --quality 85
done

echo "すべての処理が完了しました！"
```